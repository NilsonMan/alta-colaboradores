<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Alta de Colaboradores</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <style>
/* =========================
   VARIABLES / DARK MODE
========================= */
:root {
    --primary: #1c2a35;
    --bg: #e9e9e9;
    --card-bg: rgba(255, 255, 255, .82);
    --text: #333333;
    --box: rgba(238, 242, 251, .8);
    --accent: #ffd939;
}

body.dark {
    --primary: #ffd939;
    --bg: #020617;
    --card-bg: rgba(28, 42, 53, .78);
    --text: #ffffff;
    --box: rgba(255, 255, 255, .08);
}

/* =========================
   FONDO CON IMAGEN
========================= */
body {
    min-height: 100vh;
    background:
        linear-gradient(rgba(0,0,0,.4), rgba(0,0,0,.4)),
        url("https://marnez.mx/wp-content/uploads/2025/05/Recurso-1-2048x1152.png")
        center/cover fixed;
    color: var(--text);
    transition: background .3s, color .3s;
}

/* =========================
   CARD PRINCIPAL
========================= */
.card {
    border: none;
    border-radius: 22px;
    background: rgba(255, 255, 255, .35);
    backdrop-filter: blur(24px);
    box-shadow: 0 25px 60px rgba(0, 0, 0, .22);
}

body.dark .card {
    background: rgba(28, 42, 53, .45);
}

/* =========================
   TEXTOS
========================= */
h1,h2,h3,h4,h5,
label,.form-label,
.form-check-label,
p,span {
    color: var(--text) !important;
}

/* =========================
   T√çTULOS DE SECCI√ìN
========================= */
.section-title {
    font-weight: 700;
    color: var(--primary);
    margin-top: 22px;
    margin-bottom: 6px;
    font-size: 1.05rem;
}

.section-title::after {
    content: "";
    width: 45px;
    height: 3px;
    background: var(--accent);
    display: block;
    border-radius: 4px;
    margin-top: 4px;
}

/* =========================
   FORM CONTROLS
========================= */
label {
    font-weight: 500;
    font-size: .9rem;
}

.form-control,
.form-select {
    border-radius: 14px;
    background: rgba(255,255,255,.7);
    padding: 6px 10px;
    min-height: 38px;
    font-size: .95rem;
}

textarea.form-control {
    min-height: 70px;
}

body.dark .form-control,
body.dark .form-select {
    background: rgba(28,42,53,.85);
    color: #ffffff;
    border-color: #334155;
}

.form-control:focus,
.form-select:focus {
    box-shadow: 0 0 0 .15rem rgba(255,217,57,.35);
    border-color: var(--accent);
}

/* =========================
   ESPACIADOS
========================= */
.mb-3 { margin-bottom: 12px !important; }
.mb-4 { margin-bottom: 16px !important; }

/* =========================
   BOTONES
========================= */
.btn-primary {
    background: var(--primary);
    border: none;
    border-radius: 16px;
    padding: 12px;
    font-weight: 600;
    color: #fff;
}

.btn-primary:hover {
    background: var(--accent);
    color: #000;
}

/* =========================
   CAJAS
========================= */
.box {
    background: var(--box);
    padding: 12px;
    border-radius: 16px;
}

/* =========================
   MODAL
========================= */
.modal-content {
    border-radius: 18px;
    background: var(--card-bg);
    color: var(--text);
}

/* =========================
   TOGGLE DARK
========================= */
.toggle-dark {
    position: fixed;
    top: 18px;
    right: 18px;
    z-index: 999;
}

.toggle-dark button {
    border: none;
    border-radius: 50px;
    padding: 10px 16px;
    background: var(--card-bg);
    color: var(--text);
}

/* =========================
   DOCUMENTOS
========================= */
.doc-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 14px;
}

.doc-card {
    position: relative;
    perspective: 1000px;
}

.doc-inner {
    position: relative;
    width: 100%;
    height: 160px;
    transform-style: preserve-3d;
    transition: transform .7s cubic-bezier(.4,.2,.2,1);
}

.doc-card.uploaded .doc-inner {
    transform: rotateY(180deg);
}

.doc-face {
    position: absolute;
    inset: 0;
    backface-visibility: hidden;
    border-radius: 18px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 14px;
    text-align:center;
}

/* FRONT */
.doc-front {
    background: rgba(255,255,255,.65);
    border: 2px dashed rgba(28,42,53,.35);
}

body.dark .doc-front {
    background: rgba(28,42,53,.65);
}

/* BACK */
.doc-back {
    background: rgba(255,217,57,.2);
    transform: rotateY(180deg);
    border: 2px solid var(--primary);
}

/* TEXTO DOCUMENTOS EN DARK */
body.dark .doc-title,
body.dark .doc-hint,
body.dark .doc-back .status {
    color: #ffffff !important;
}

.doc-icon {
    font-size: 28px;
    color: var(--primary);
}

body.dark .doc-icon {
    color: var(--accent);
}

.doc-title {
    font-size: .9rem;
    font-weight: 600;
}

.doc-hint {
    font-size: .75rem;
    opacity: .7;
}

.doc-card input[type="file"] {
    position: absolute;
    inset: 0;
    opacity: 0;
    cursor: pointer;
}

/* BOTONES DOCUMENTOS */
.btn-preview {
    font-size: .8rem;
    padding: 6px 12px;
    border-radius: 12px;
}

    </style>


</head>

<body>

    <!-- BOT√ìN DARK MODE -->
    <div class="toggle-dark">
        <button onclick="toggleDark()">üåô / ‚òÄÔ∏è</button>
    </div>
    <!-- MODAL PREVISUALIZACI√ìN -->
    <div class="modal fade" id="modalPreview" tabindex="-1">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Previsualizaci√≥n del documento</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body text-center">
                    <iframe id="previewFrame" style="width:100%;height:75vh;border:none;display:none;"></iframe>

                    <img id="previewImg" style="max-width:100%;max-height:75vh;display:none;">
                </div>
            </div>
        </div>
    </div>



    <div class="container py-4">
        <div class="row justify-content-center">
            <div class="col-xl-11">

                <div class="card">
                    <div class="card-body p-4 p-md-5">

                        <h3 class="text-center fw-bold mb-4" style="color:var(--primary)">
                            Alta de Colaboradores
                        </h3>

                        <label class="form-label fw-bold">√Årea</label>
                        <select id="area" class="form-select mb-4" onchange="seleccionarArea()">
                            <option value="">Selecciona un √°rea</option>
                            {% for area in areas %}
                            <option value="{{ area.id }}">{{ area.nombre }}</option>
                            {% endfor %}
                        </select>

                        <form id="formulario" class="d-none" method="POST" enctype="multipart/form-data">
                            <input type="hidden" name="area" id="areaSeleccionada">

                            <div class="section-title">Correo institucional</div>
                            <input id="correo" name="correo" class="form-control mb-3" required>

                            <div class="section-title">Datos personales</div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label>Nombre</label>
                                    <input name="nombre" class="form-control" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label>Apellido</label>
                                    <input name="apellido" class="form-control" required>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-3 mb-3">
                                    <label>Edad</label>
                                    <input type="number" name="edad" class="form-control">
                                </div>
                                <div class="col-md-3 mb-3">
                                    <label>Estado civil</label>
                                    <select name="estado_civil" class="form-select">
                                        <option value="">Seleccione</option>
                                        <option>Soltero(a)</option>
                                        <option>Casado(a)</option>
                                        <option>Divorciado(a)</option>
                                        <option>Viudo(a)</option>
                                    </select>
                                </div>
                                <div class="col-md-3 mb-3">
                                    <label>Tel√©fono</label>
                                    <input name="telefono" class="form-control">
                                </div>
                            </div>

                            <label>Domicilio</label>
                            <textarea name="domicilio" class="form-control mb-3"></textarea>

                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label>RFC</label>
                                    <input name="rfc" class="form-control">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label>CURP</label>
                                    <input name="curp" class="form-control">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label>NSS</label>
                                    <input name="nss" class="form-control">
                                </div>
                            </div>

                            <label>Fecha de alta</label>
                            <input type="date" name="fecha_alta" class="form-control form-control-sm mb-3" required>
                            <div id="bloqueComercial" class="d-none">

                                <div class="section-title">Informaci√≥n comercial</div>

                                <label>Puesto comercial</label>
                                <select name="rol_comercial" class="form-select mb-3">
                                    <option value="">Seleccione</option>
                                    <option>Asesor Diamante</option>
                                    <option>Asesor Externo</option>
                                    <option>Asesor Interno</option>
                                    <option>Inmobiliaria</option>
                                    <option>Inmobiliaria Premium</option>
                                </select>

                                <label>¬øEs comisionista?</label>
                                <select id="comisionista" name="comisionista" class="form-select mb-3"
                                    onchange="toggleComisionista()">
                                    <option>No</option>
                                    <option>S√≠</option>
                                </select>

                                <label id="labelComisiones" class="d-none">N√∫mero de comisiones</label>
                                <input id="numero_comisiones" name="numero_comisiones" class="form-control mb-3 d-none">

                            </div>


                            <div class="section-title">Informaci√≥n laboral</div>

                            <label>Puesto</label>
                            <select id="puesto" name="puesto" class="form-select mb-3" required></select>

                            <label id="labelSueldo">Sueldo</label>
                            <input id="sueldo" type="number" name="sueldo" class="form-control mb-3">

                            <label>Reclutador(es)</label>
                            <select name="reclutador" class="form-select mb-3">
                                <option value="">Seleccione</option>
                                {% for r in reclutadores %}
                                <option value="{{ r.id }}">{{ r.nombre }}</option>
                                {% endfor %}
                            </select>

                            <label>M√©todo de pago</label>
                            <select name="metodo_pago" class="form-select mb-3" required>
                                <option value="">Seleccione</option>
                                {% for m in metodos_pago %}
                                <option value="{{ m.id }}">{{ m.nombre }}</option>
                                {% endfor %}
                            </select>

                            <label>Banco</label>
                            <select id="banco" name="banco" class="form-select mb-3">
                                <option value="">Seleccione</option>
                                {% for b in bancos %}
                                <option value="{{ b.id }}">{{ b.nombre }}</option>
                                {% endfor %}
                            </select>

                            <label id="labelCuenta">N√∫mero de cuenta (16 o 18 d√≠gitos)</label>
                            <input id="numero_cuenta" name="numero_cuenta" class="form-control mb-3" maxlength="18"
                                pattern="[0-9]{16,18}">


                            <div class="section-title">Cr√©ditos</div>

                            <div class="row">
                                <div class="col-md-6">
                                    <label>¬øTiene Infonavit?</label>
                                    <select name="infonavit" class="form-select mb-2"
                                        onchange="toggleCredito('infonavit')">
                                        <option>No</option>
                                        <option>S√≠</option>
                                    </select>
                                    <input id="infonavit_credito" name="infonavit_credito"
                                        class="form-control mb-3 d-none">
                                </div>

                                <div class="col-md-6">
                                    <label>¬øTiene Fonacot?</label>
                                    <select name="fonacot" class="form-select mb-2" onchange="toggleCredito('fonacot')">
                                        <option>No</option>
                                        <option>S√≠</option>
                                    </select>
                                    <input id="fonacot_credito" name="fonacot_credito" class="form-control mb-3 d-none">
                                </div>
                            </div>

                            <div class="section-title">Documentaci√≥n</div>

                            <div class="box">
                                <div class="doc-grid">

                                    {% for d in ["Constancia fiscal","CURP","INE","RFC","NSS","Comprobante
                                    domicilio","Comprobante estudios","Carta 1","Carta 2"] %}
                                    <div class="doc-card">
                                        <div class="doc-inner">

                                            <!-- FRONT -->
                                            <div class="doc-face doc-front">
                                                <div class="doc-icon">üìÑ</div>
                                                <div class="doc-title">{{ d }}</div>
                                                <div class="doc-hint">Arrastra o selecciona archivo</div>
                                                <input type="file" name="documentos[]" accept=".pdf,.jpg,.jpeg,.png"
                                                    onchange="documentoCargado(this)">
                                            </div>

                                            <!-- BACK -->
                                            <div class="doc-face doc-back">
                                                <div class="status">‚úÖ Documento cargado</div>

                                                <div class="d-flex gap-2">
                                                    <button type="button" class="btn btn-outline-primary btn-preview"
                                                        onclick="previsualizarDocumento(this)">
                                                        üëÅÔ∏è Previsualizar
                                                    </button>

                                                    <button type="button" class="btn btn-outline-secondary btn-preview"
                                                        onclick="cambiarDocumento(this)">
                                                        üîÅ Cambiar
                                                    </button>
                                                </div>
                                            </div>


                                        </div>
                                    </div>
                                    {% endfor %}

                                </div>
                            </div>




                            <div class="section-title">Equipo electr√≥nico</div>
                            <div class="box">
                                {% for r in recursos %}
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="equipo[]" value="{{ r.id }}">
                                    <label class="form-check-label">{{ r.nombre }}</label>
                                </div>
                                {% endfor %}
                            </div>

                            <div class="section-title">Programas</div>
                            <div class="box">
                                {% for p in programas %}
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="programas[]"
                                        value="{{ p.id }}">
                                    <label class="form-check-label">{{ p.nombre }}</label>
                                </div>
                                {% endfor %}
                            </div>

                            <div class="section-title">Comentarios</div>
                            <textarea name="comentarios" class="form-control mb-4"></textarea>

                            <button class="btn btn-primary w-100">Guardar colaborador</button>
                        </form>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL CORREO (NO TOCADO) -->
    <div class="modal fade" id="modalCorreo" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Confirmar correo</h5>
                </div>
                <div class="modal-body">
                    <p>¬øEl correo ingresado es correcto?<br>
                        <strong>Este correo no podr√° modificarse m√°s adelante.</strong>
                    </p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="correoNo">No, corregir</button>
                    <button type="button" class="btn btn-primary" id="correoSi">S√≠, es correcto</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        function toggleDark() {
            document.body.classList.toggle("dark");
        }

        function seleccionarArea() {
            const select = document.getElementById("area");
            const texto = select.options[select.selectedIndex].text.toLowerCase();
            const esComercial = texto.includes("comercial");

            document.getElementById("formulario").classList.remove("d-none");
            document.getElementById("areaSeleccionada").value = select.value;

            document.getElementById("bloqueComercial")
                .classList.toggle("d-none", !esComercial);

            fetch(`/puestos/${select.value}`)
                .then(r => r.json())
                .then(data => {
                    const p = document.getElementById("puesto");
                    p.innerHTML = "";
                    data.forEach(x => {
                        const o = document.createElement("option");
                        o.value = x.id;
                        o.text = x.nombre;
                        p.appendChild(o);
                    });
                });
        }

        function toggleComisionista() {
            const es = document.getElementById("comisionista").value === "S√≠";
            document.getElementById("sueldo").classList.toggle("d-none", es);
            document.getElementById("labelSueldo").classList.toggle("d-none", es);
            document.getElementById("numero_cuenta").classList.toggle("d-none", es);
            document.getElementById("labelCuenta").classList.toggle("d-none", es);
            document.getElementById("numero_comisiones").classList.toggle("d-none", !es);
            document.getElementById("labelComisiones").classList.toggle("d-none", !es);
        }

        function toggleCredito(tipo) {
            document.getElementById(tipo + "_credito")
                .classList.toggle("d-none", event.target.value !== "S√≠");
        }

        const correoInput = document.getElementById("correo");
        const modalCorreo = new bootstrap.Modal(document.getElementById("modalCorreo"));
        let correoConfirmado = false;

        correoInput.addEventListener("blur", () => {
            if (correoInput.value.trim() !== "" && !correoConfirmado) {
                modalCorreo.show();
            }
        });

        document.getElementById("correoSi").onclick = () => {
            correoConfirmado = true;
            correoInput.readOnly = true;
            modalCorreo.hide();
        };

        document.getElementById("correoNo").onclick = () => {
            correoInput.readOnly = false;
            correoInput.focus();
            modalCorreo.hide();
        };
        let archivoActual = null;

        function documentoCargado(input) {
            const card = input.closest(".doc-card");
            card.classList.add("uploaded");
            archivoActual = input.files[0];
        }

        function previsualizarDocumento(btn) {
            const card = btn.closest(".doc-card");
            const input = card.querySelector("input[type=file]");
            const file = input.files[0];
            if (!file) return;

            const url = URL.createObjectURL(file);
            const iframe = document.getElementById("previewFrame");
            const img = document.getElementById("previewImg");

            iframe.style.display = "none";
            img.style.display = "none";

            if (file.type.includes("pdf")) {
                iframe.src = url;
                iframe.style.display = "block";
            } else if (file.type.includes("image")) {
                img.src = url;
                img.style.display = "block";
            }

            new bootstrap.Modal(document.getElementById("modalPreview")).show();
        }
        function cambiarDocumento(btn) {
            const card = btn.closest(".doc-card");
            const input = card.querySelector("input[type=file]");

            // limpiar archivo
            input.value = "";

            // reset visual
            card.classList.remove("uploaded");

            // opcional: feedback suave
            card.classList.add("shake");
            setTimeout(() => card.classList.remove("shake"), 400);

            // abrir selector otra vez
            input.click();
        }


    </script>

</body>

</html>