<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Alta de Colaboradores</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body{background:#f3f4f8;}
.card{border-radius:18px;border:none;}
.section-title{
    font-weight:700;
    color:#2f5597;
    margin-top:35px;
    margin-bottom:10px;
}
.section-title::after{
    content:"";
    width:50px;
    height:4px;
    background:#2f5597;
    display:block;
    border-radius:4px;
    margin-top:6px;
}
.form-control,.form-select{border-radius:12px}
.form-control:focus,.form-select:focus{
    box-shadow:0 0 0 .15rem rgba(47,85,151,.25);
    border-color:#2f5597;
}
.btn-primary{
    background:#2f5597;
    border:none;
    border-radius:14px;
    padding:14px;
    font-weight:600;
}
.btn-primary:hover{background:#24457a}
.box{
    background:#eef2fb;
    padding:15px;
    border-radius:12px;
}
</style>
</head>

<body>
<div class="container py-4">
<div class="row justify-content-center">
<div class="col-xl-11">

<div class="card shadow">
<div class="card-body p-4 p-md-5">

<h3 class="text-center fw-bold mb-4 text-primary">
Alta de Colaboradores
</h3>

<!-- ================= ÁREA ================= -->
<label class="form-label fw-bold">Área</label>
<select id="area" class="form-select mb-4" onchange="seleccionarArea()">
<option value="">Selecciona un área</option>
{% for area in areas %}
<option value="{{ area.id }}">{{ area.nombre }}</option>
{% endfor %}
</select>

<form id="formulario" class="d-none" method="POST" enctype="multipart/form-data">
<input type="hidden" name="area" id="areaSeleccionada">

<!-- ================= CORREO ================= -->
<div class="section-title">Correo institucional</div>
<input id="correo"
       name="correo"
       class="form-control mb-3"
       required
       onblur="confirmarCorreo()">

<!-- ================= DATOS PERSONALES ================= -->
<div class="section-title">Datos personales</div>

<div class="row">
<div class="col-md-6 mb-3">
<label>Nombre</label>
<input name="nombre" class="form-control" required>
</div>
<div class="col-md-6 mb-3">
<label>Apellido</label>
<input name="apellido" class="form-control" required>
</div>
</div>

<div class="row">
<div class="col-md-3 mb-3">
<label>Edad</label>
<input type="number" name="edad" class="form-control">
</div>
<div class="col-md-3 mb-3">
<label>Estado civil</label>
<select name="estado_civil" class="form-select">
<option value="">Seleccione</option>
<option>Soltero(a)</option>
<option>Casado(a)</option>
<option>Divorciado(a)</option>
<option>Viudo(a)</option>
</select>
</div>
<div class="col-md-3 mb-3">
<label>Teléfono</label>
<input name="telefono" class="form-control">
</div>
</div>

<label>Domicilio</label>
<textarea name="domicilio" class="form-control mb-3"></textarea>

<div class="row">
<div class="col-md-4 mb-3">
<label>RFC</label>
<input name="rfc" class="form-control">
</div>
<div class="col-md-4 mb-3">
<label>CURP</label>
<input name="curp" class="form-control">
</div>
<div class="col-md-4 mb-3">
<label>NSS</label>
<input name="nss" class="form-control">
</div>
</div>

<label>Fecha de alta</label>
<input type="date" name="fecha_alta" class="form-control mb-3" required>

<!-- ================= LABORAL ================= -->
<div class="section-title">Información laboral</div>

<label>Puesto</label>
<select id="puesto" name="puesto" class="form-select mb-3" required></select>

<div class="row">
<div class="col-md-6 mb-3">
<label>Sueldo</label>
<input type="number" name="sueldo" class="form-control">
</div>
</div>

<!-- ================= COMERCIAL ================= -->
<div id="bloqueComercial" class="d-none">
<div class="section-title">Información comercial</div>

<select name="rol_comercial" class="form-select mb-3">
<option value="">Rol comercial</option>
<option>Gerente de ventas</option>
<option>Coordinador de ventas</option>
<option>Asesor</option>
</select>

<select id="comisionista" name="comisionista" class="form-select mb-3">
<option>No</option>
<option>Sí</option>
</select>
</div>

<!-- ================= CRÉDITOS ================= -->
<div class="section-title">Créditos</div>

<div class="row">
<div class="col-md-6">
<label>¿Tiene Infonavit?</label>
<select name="infonavit" class="form-select mb-2"
onchange="toggleCredito('infonavit')">
<option>No</option>
<option>Sí</option>
</select>

<input id="infonavit_credito"
name="infonavit_credito"
class="form-control mb-3 d-none"
placeholder="Número de crédito Infonavit">
</div>

<div class="col-md-6">
<label>¿Tiene Fonacot?</label>
<select name="fonacot" class="form-select mb-2"
onchange="toggleCredito('fonacot')">
<option>No</option>
<option>Sí</option>
</select>

<input id="fonacot_credito"
name="fonacot_credito"
class="form-control mb-3 d-none"
placeholder="Número de crédito Fonacot">
</div>
</div>

<!-- ================= DOCUMENTOS ================= -->
<div class="section-title">Documentación</div>
<div class="box">
{% for d in [
"Constancia fiscal","CURP","INE","RFC","NSS",
"Comprobante domicilio","Comprobante estudios","Carta 1","Carta 2"
] %}
<label>{{ d }}</label>
<input type="file" name="documentos[]" class="form-control mb-2">
{% endfor %}
</div>

<!-- ================= EQUIPO TI ================= -->
<div class="section-title">Equipo electrónico</div>
<div class="box">
{% for r in recursos %}
<div class="form-check">
<input class="form-check-input" type="checkbox" name="equipo[]" value="{{ r.id }}">
<label class="form-check-label">{{ r.nombre }}</label>
</div>
{% endfor %}
</div>

<!-- ================= PROGRAMAS ================= -->
<div class="section-title">Programas</div>
<div class="box">
{% for p in programas %}
<div class="form-check">
<input class="form-check-input" type="checkbox" name="programas[]" value="{{ p.id }}">
<label class="form-check-label">{{ p.nombre }}</label>
</div>
{% endfor %}
</div>

<!-- ================= COMENTARIOS ================= -->
<div class="section-title">Comentarios</div>
<textarea name="comentarios" class="form-control mb-4"></textarea>

<button class="btn btn-primary w-100">
Guardar colaborador
</button>

</form>

</div>
</div>
</div>
</div>
</div>

<!-- ============ MODAL CORREO ============ -->
<div class="modal fade" id="modalCorreo" tabindex="-1">
<div class="modal-dialog modal-dialog-centered">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title">Confirmar correo</h5>
<button class="btn-close" data-bs-dismiss="modal"></button>
</div>
<div class="modal-body">
¿El correo <strong id="correoTexto"></strong> es correcto?<br>
<strong>Este correo no podrá modificarse después.</strong>
</div>
<div class="modal-footer">
<button class="btn btn-secondary" onclick="editarCorreo()">No</button>
<button class="btn btn-primary" onclick="bloquearCorreo()">Sí, es correcto</button>
</div>
</div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
let correoConfirmado=false;

function confirmarCorreo(){
    const correo=document.getElementById("correo");
    if(correoConfirmado || !correo.value) return;

    const regex=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if(!regex.test(correo.value)){
        alert("Formato de correo inválido");
        return;
    }

    document.getElementById("correoTexto").innerText=correo.value;
    new bootstrap.Modal(document.getElementById("modalCorreo")).show();
}

function bloquearCorreo(){
    const correo=document.getElementById("correo");
    correo.readOnly=true;
    correo.classList.add("bg-light");
    correoConfirmado=true;
    bootstrap.Modal.getInstance(document.getElementById("modalCorreo")).hide();
}

function editarCorreo(){
    bootstrap.Modal.getInstance(document.getElementById("modalCorreo")).hide();
}

function seleccionarArea(){
    const select=document.getElementById("area");
    const texto=select.options[select.selectedIndex].text.toLowerCase();
    const esComercial=texto.includes("comercial");

    document.getElementById("formulario").classList.remove("d-none");
    document.getElementById("areaSeleccionada").value=select.value;

    document.getElementById("bloqueComercial")
        .classList.toggle("d-none",!esComercial);

    fetch(`/puestos/${select.value}`)
    .then(r=>r.json())
    .then(data=>{
        const p=document.getElementById("puesto");
        p.innerHTML="";
        data.forEach(x=>{
            const o=document.createElement("option");
            o.value=x.id;
            o.text=x.nombre;
            p.appendChild(o);
        });
    });
}

function toggleCredito(tipo){
    const input=document.getElementById(tipo+"_credito");
    if(event.target.value==="Sí"){
        input.classList.remove("d-none");
    }else{
        input.classList.add("d-none");
        input.value="";
    }
}
</script>

</body>
</html>
